ARG PHP_VERSION=""
FROM build/php:${PHP_VERSION}-fpm

ENV COMPOSER_VERSION="1.8.5" \
    COMPOSER_HASH="4e4c1cd74b54a26618699f3190e6f5fc63bb308b13fa660f71f2a2df047c0e17"

RUN set -e -o pipefail; \
    cd /tmp; \
    wget https://getcomposer.org/download/${COMPOSER_VERSION}/composer.phar; \
    if [ "$(sha256sum ./composer.phar | awk '{ print $1; }')" != "$COMPOSER_HASH" ]; then \
        echo "Composer file checksum doesn't match. This version of composer might be corrupted."; \
        exit 1; \
    fi; \
    chmod +x composer.phar; \
    mv composer.phar /usr/local/bin/composer; \
    composer global require hirak/prestissimo; \
    composer update || true
